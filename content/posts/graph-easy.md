---
title: "Graph Easyの使い方"
date: 2020-09-22T13:06:33+09:00
draft: false
tags: ["tool", "CLI"]
---

## Graph Easyとは

テキストベースで作成したコードから、アスキーアートの状態遷移図とか作れるツール。

こんな感じのコードから...。

```txt
[Alice] -> [Bob]
```

こんな感じのアスキーアートを作れる。

```txt
+-------+     +-----+
| Alice | --> | Bob |
+-------+     +-----+
```

## インストール

Perlのパッケージマネージャであるcpanを使用してインストールする。

```sh
cpan install Graph::Easy
```

## 使い方

以下のコマンドを実行する。

```sh
graph-easy <ソースファイル名>
```

より詳細については、以下の記事が参考になる。

[Graph::Easyの使い方 - Qiita](https://qiita.com/Takeru/items/772218255b9cd92fc05e)

## 残念なところ

全角文字も、半角の幅の長さで計算されている。
そのため、以下のようにアスキーアートが崩れてしまう。

```txt
このコードが...
[あ]

こんなふうになってしまう...
+---+
| あ |
+---+
```

一応、以下の記事で紹介されているパッチを使えば良さそうだけど...正直そこまでやりたくない...。

[本を読む Perlでカラム数単位のlengthとsubstrを作ってみる](http://emasaka.blog65.fc2.com/?m&no=504)

## 暫定の対処

自分の用途としては、Vim上で編集しているときにちょっとしたアスキーアートを作成するために
使う程度なので、以下のキーマッピングを使うことでとりあえずは満足している。
(かなりひどい対応だが、今の所それほど問題になっていない)

```vim
vnoremap ge :s/[^\x01-\x7E]/&薔/ge<CR> \| gv:!graph-easy<CR> \| :'[,']s/薔//ge<CR>
```

このキーマッピングを使うと以下の動画のように、選択範囲のテキストに対してGrapy::Easyの
変換を適用できる。(補足：Asciinemaでのフォントの関係上、若干ずれているように見えるが実際にはちゃんとできている。)

<script id="asciicast-hr6mq96Kg7i89UqlPAjAnFKqT" src="https://asciinema.org/a/hr6mq96Kg7i89UqlPAjAnFKqT.js" async></script>

このキーマッピングでは以下のような処理を行っている。

1. `:s/[^\x01-\x7E]/&薔/ge<CR>` の部分。
選択範囲の全角文字(`[^\x01-\x7E]`という正規表現に一致するもの)の直後に「薔」という
文字を追加して、全角文字の横幅を無理やり文字2つ分にする。
(なお、「薔」という文字は別に他のものでも構わないが、自分が絶対に使わないであろう文字を暫定で選んだ)

```txt
このテキストが
[おはよう]

以下のように変換される
[お薔は薔よ薔う薔]
```

2. `gv:!graph-easy<CR>` の部分。
先程選択していた範囲のテキストを標準入力として `graph-easy` コマンドに与えて、
その出力結果でもとのテキストを置き換える。

```txt
このテキストが
[お薔は薔よ薔う薔]

以下のように変換される
+----------+
| お薔は薔よ薔う薔 |
+----------+
```

3. `:'[,']s/薔//ge<CR>` の部分。
「1.」のときに横幅の帳尻合わせのために追加した文字を削除する。

```txt
このテキストが
[お薔は薔よ薔う薔]

以下のように変換される
+----------+
| おはよう |
+----------+
```

## 参考

* [Graph::Easyの使い方 - Qiita](https://qiita.com/Takeru/items/772218255b9cd92fc05e)
* [本を読む Perlでカラム数単位のlengthとsubstrを作ってみる](http://emasaka.blog65.fc2.com/?m&no=504)
