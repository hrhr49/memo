<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><title>ESPnet | hrhr49 blog</title><meta name=description content="ESPnetメモ 音声合成(テキスト読み上げ)関連のツールを探しているときに見つけたいい感じのツール。 end-to-endのスピーチ処理のツー"><meta name=generator content="Hugo 0.74.2"><link rel=canonical href=https://hrhr49.github.io/memo/posts/espnet/><link rel=stylesheet href=https://hrhr49.github.io/memo//css/style.css><link rel=stylesheet href=https://hrhr49.github.io/memo//css/syntax.css><link rel=stylesheet href=https://hrhr49.github.io/memo//css/custom.css></head><body><header class=container><div class=row><a href=https://hrhr49.github.io/memo/><h1 class=logo>hrhr49 blog</h1></a></div><div class=row><ul><li style=display:inline-block;padding:5px><a href=/memo/categories/>Categories</a></li><li style=display:inline-block;padding:5px><a href=/memo/search/>Search</a></li><li style=display:inline-block;padding:5px><a href=/memo/tags/>Tags</a></li></ul></div></header><div id=content><div class=container><div class="post paper"><h1 class=page-title>ESPnet</h1><div class=date>2020-11-01</div><h1 id=espnetメモ>ESPnetメモ</h1><p>音声合成(テキスト読み上げ)関連のツールを探しているときに見つけたいい感じのツール。
end-to-endのスピーチ処理のツールキットらしい。
どうやら、ESPnet2というのがあってこっちのが新しいみたい。同一のリポジトリで管理してるっぽい。</p><p>公式ページ</p><ul><li><a href=https://espnet.github.io/espnet/>https://espnet.github.io/espnet/</a></li></ul><p>GitHubのページ</p><ul><li><a href=https://github.com/espnet/espnet>https://github.com/espnet/espnet</a></li></ul><h2 id=紹介されていたデモページ>紹介されていたデモページ</h2><p>Google ColaboratryでTTS(Text to Speech)を動かせるデモがあった(ESPnet2のもの)。
日本語の音声合成をやってみた感じ、とてもなめらかに発音できてそうだった！</p><p><a href=https://colab.research.google.com/github/espnet/notebook/blob/master/espnet2_tts_realtime_demo.ipynb>https://colab.research.google.com/github/espnet/notebook/blob/master/espnet2_tts_realtime_demo.ipynb</a></p><h2 id=自分の環境で動かすやり方>自分の環境で動かすやり方</h2><p>現在調査中。適宜分かり次第、追記していく予定。</p><h3 id=環境>環境</h3><ul><li>Ubuntu 20.04.1 LTS x86_64</li><li>NVIDIA GeForce RTX 2060 Rev. A</li><li>ESPnet v.0.9.5</li></ul><h3 id=方針>方針</h3><p>とりあえず、Dockerで動かせそうなので、それを目標にする。</p><p><a href=https://espnet.github.io/espnet/docker.html#>https://espnet.github.io/espnet/docker.html#</a></p><p>上記のドキュメントを参考に、 <code>docker</code> ディレクトリでコマンドを実行した。</p><h3 id=問題1-could-not-select-device-driver--with-capabilities-gpu>問題1 <code>could not select device driver "" with capabilities: [[gpu]]</code></h3><p>うまく行かなかった。
(なんか<code>could not select device driver "" with capabilities: [[gpu]]</code> みたいなのが
表示されてエラーになった)</p><p>以下のissueによると、
<a href=https://github.com/espnet/espnet/issues/2041>https://github.com/espnet/espnet/issues/2041</a></p><p>これが原因らしい。
<a href=https://github.com/NVIDIA/nvidia-docker/issues/1034>https://github.com/NVIDIA/nvidia-docker/issues/1034</a></p><p>議論をいろいろ見ていくと、どうやら <code>nvidia-container-toolkit</code> なるものを
インストールした後、 <code>systemctl restart dockerd</code> をやる必要があるみたいだった。</p><p><code>nvidia-container-toolkit</code> と言うやつは、dockerのコンテナ上でcudaを動かすやつらしい。
とのことで、以下の記事を参考(もともとは公式ページの手順から引用しているみたい)に<code>nvidia-container-toolkit</code>
を入れたら、このエラーは解決した。</p><p><a href=https://qiita.com/Hiroaki-K4/items/c1be8adba18b9f0b4cef>https://qiita.com/Hiroaki-K4/items/c1be8adba18b9f0b4cef</a></p><p>↓上記URLの内容から引用</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span><span class=c1># Add the package repositories</span>
<span class=ln>2</span><span class=nv>distribution</span><span class=o>=</span><span class=k>$(</span>. /etc/os-release<span class=p>;</span><span class=nb>echo</span> <span class=nv>$ID$VERSION_ID</span><span class=k>)</span>
<span class=ln>3</span>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey <span class=p>|</span> sudo apt-key add -
<span class=ln>4</span>curl -s -L https://nvidia.github.io/nvidia-docker/<span class=nv>$distribution</span>/nvidia-docker.list <span class=p>|</span> sudo tee /etc/apt/sources.list.d/nvidia-docker.list
<span class=ln>5</span>
<span class=ln>6</span>sudo apt-get update <span class=o>&amp;&amp;</span> sudo apt-get install -y nvidia-container-toolkit
<span class=ln>7</span>sudo systemctl restart docker
</code></pre></div><h3 id=問題2-runsh-invalid-option---dlayers>問題2 <code>./run.sh: invalid option --dlayers</code></h3><p>以下のようなエラー内容が表示された。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>./run.sh: invalid option --dlayers
</code></pre></div><p><a href=https://github.com/espnet/espnet/issues/1619>https://github.com/espnet/espnet/issues/1619</a>
の議論の中で同じことに触れられているっぽい。</p><p>とりあえず、この問題は置いといて、TTSのプログラムを動かすためには
以下を実行すれば良かったっぽいので今回は深入りしない。</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=ln>1</span>./run.sh --docker_gpu <span class=m>0</span> --docker_egs ljspeech/tts1 --docker_folders /export/ljspeech/tts1 -ngpu <span class=m>1</span>
<span class=ln>2</span><span class=sb>``</span>
<span class=ln>3</span>
<span class=ln>4</span>この詳細はまだ調査中・・・・
</code></pre></div><br>Categories:</div></div></div><hr><footer class=container><div class=copyright>Copyright © hrhr49; all rights reserved.</div></footer></body></html>